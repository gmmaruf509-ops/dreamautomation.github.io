<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Dream Automation ‚Äì Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: radial-gradient(circle at top, #201447, #050119 60%);
        color: #f8fafc;
      }
      a {
        color: inherit;
        text-decoration: none;
      }
      .layout {
        display: flex;
        min-height: 100vh;
      }
      /* Sidebar */
      .sidebar {
        width: 230px;
        background: linear-gradient(180deg, #050119, #05040f);
        border-right: 1px solid rgba(148, 163, 184, 0.1);
        padding: 20px 16px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }
      .logo {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 700;
        font-size: 18px;
      }
      .logo-icon {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        background: linear-gradient(135deg, #f97316, #ec4899);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 900;
      }
      .menu-section-title {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        opacity: 0.5;
        margin-bottom: 6px;
      }
      .menu {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .menu-item {
        padding: 9px 10px;
        border-radius: 10px;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        color: #cbd5f5;
      }
      .menu-item:hover {
        background: rgba(148, 163, 184, 0.08);
      }
      .menu-item.active {
        background: linear-gradient(90deg, #0ea5e9, #22c55e);
        color: #0b1220;
        font-weight: 600;
      }
      .menu-item-icon {
        font-size: 16px;
      }
      .sidebar-footer {
        margin-top: auto;
        font-size: 11px;
        opacity: 0.5;
      }
      /* Main */
      .main {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      .topbar {
        height: 56px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.12);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 32px;
        background: radial-gradient(circle at top left, #1e293b33, transparent);
      }
      .topbar-left {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
      }
      .topbar-title {
        font-weight: 600;
        font-size: 15px;
      }
      .topbar-badge {
        font-size: 11px;
        padding: 2px 7px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.2);
        color: #e5e7eb;
      }
      .topbar-right {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 14px;
      }
      .chip {
        padding: 5px 10px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.3);
        font-size: 13px;
      }
      .btn {
        border-radius: 999px;
        border: 0;
        cursor: pointer;
        font-size: 13px;
        padding: 7px 14px;
        font-weight: 500;
      }
      .btn-outline {
        background: transparent;
        color: #e5e7eb;
        border: 1px solid rgba(148, 163, 184, 0.6);
      }
      .btn-primary {
        background: linear-gradient(135deg, #22c55e, #0ea5e9);
        color: #020617;
      }
      .btn-primary:disabled {
        opacity: 0.6;
        cursor: default;
      }
      .btn-danger {
        background: linear-gradient(135deg, #ef4444, #f97316);
        color: #0b1220;
      }
      .content {
        padding: 24px 32px 28px;
        overflow-x: hidden;
      }
      .section-title {
        font-size: 26px;
        font-weight: 700;
        margin-bottom: 4px;
      }
      .section-subtitle {
        font-size: 13px;
        opacity: 0.7;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.08);
        border: 1px solid rgba(148, 163, 184, 0.2);
        font-size: 11px;
        margin-bottom: 10px;
      }
      .pill-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
      }
      .grid-2 {
        display: grid;
        grid-template-columns: minmax(0, 1.8fr) minmax(0, 1.2fr);
        gap: 20px;
        margin-top: 18px;
      }
      .card {
        background: radial-gradient(circle at top left, #1f2937aa, #020617ee);
        border-radius: 20px;
        border: 1px solid rgba(148, 163, 184, 0.16);
        padding: 18px 18px 16px;
      }
      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }
      .card-title {
        font-size: 15px;
        font-weight: 600;
      }
      .pill-small {
        font-size: 11px;
        padding: 2px 8px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.35);
      }
      .tag-row {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 12px;
      }
      .tag {
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 11px;
        border: 1px solid rgba(148, 163, 184, 0.3);
        opacity: 0.85;
      }
      .btn-wide {
        margin-top: 8px;
        width: 100%;
        padding: 10px 14px;
        font-size: 14px;
        border-radius: 999px;
        border: 0;
        cursor: pointer;
        background: linear-gradient(90deg, #22c55e, #0ea5e9);
        color: #020617;
        font-weight: 600;
      }
      .btn-wide.secondary {
        background: rgba(15, 23, 42, 0.9);
        color: #e5e7eb;
        border: 1px solid rgba(148, 163, 184, 0.4);
      }
      .small-text {
        font-size: 11px;
        opacity: 0.65;
        margin-top: 6px;
      }
      .trial-status {
        font-size: 13px;
        margin: 8px 0 4px;
      }

      /* ===== KEY BOX ‚Äì ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡ßú ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá ===== */
      .trial-key-box {
        margin-top: 12px;
        padding: 14px 18px;
        border-radius: 14px;
        background: rgba(15, 23, 42, 0.96);
        border: 1px dashed rgba(96, 165, 250, 0.9);
        text-align: center;
      }
      .trial-key {
        font-family: "Consolas", ui-monospace, SFMono-Regular, Menlo, Monaco,
          "Liberation Mono", "Courier New", monospace;
        font-size: 20px; /* ‡¶¨‡¶°‡¶º ‡¶´‡¶®‡ßç‡¶ü */
        letter-spacing: 0.08em;
        color: #e5e7eb;
        word-break: break-all;
      }
      .trial-key-label {
        font-size: 16px;
        font-weight: 700;
        margin-right: 8px;
      }
      .trial-key-value {
        font-weight: 600;
        color: #7dd3fc;
      }

      .pill-plan {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 3px 9px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.9);
        border: 1px solid rgba(96, 165, 250, 0.7);
        font-size: 11px;
      }
      .pill-plan-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #22c55e;
      }
      .tools-section {
        margin-top: 26px;
      }
      .tools-grid {
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1.2fr);
        gap: 12px;
      }
      .tool-card {
        background: radial-gradient(circle at top left, #111827dd, #020617f0);
        border-radius: 16px;
        padding: 12px 14px;
        border: 1px solid rgba(148, 163, 184, 0.2);
        font-size: 13px;
      }
      .tool-title {
        font-weight: 600;
        margin-bottom: 4px;
      }
      .footer {
        margin-top: 28px;
        font-size: 11px;
        opacity: 0.6;
        text-align: center;
      }
      .footer span {
        opacity: 0.8;
      }
      @media (max-width: 980px) {
        .layout {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          flex-direction: row;
          align-items: center;
          justify-content: space-between;
          padding-bottom: 12px;
        }
        .main {
          flex: 1;
        }
        .grid-2 {
          grid-template-columns: minmax(0, 1fr);
        }
        .tools-grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div>
          <div class="logo">
            <div class="logo-icon">DA</div>
            <div>
              <div>Dream</div>
              <div style="font-size: 13px; opacity: 0.7">Automation</div>
            </div>
          </div>

          <div style="margin-top: 24px">
            <div class="menu-section-title">Main</div>
            <nav class="menu">
              <div class="menu-item active">
                <span class="menu-item-icon">üè†</span>
                <span>Dashboard</span>
              </div>
              <div class="menu-item">
                <span class="menu-item-icon">üì¶</span>
                <span>My Products</span>
              </div>
              <div class="menu-item">
                <span class="menu-item-icon">üßæ</span>
                <span>Orders</span>
              </div>
            </nav>
          </div>

          <div style="margin-top: 18px">
            <div class="menu-section-title">Account</div>
            <nav class="menu">
              <div class="menu-item">
                <span class="menu-item-icon">‚öôÔ∏è</span>
                <span>Account Settings</span>
              </div>
              <div class="menu-item">
                <span class="menu-item-icon">üí¨</span>
                <span>Support Center</span>
              </div>
            </nav>
          </div>
        </div>

        <div class="sidebar-footer">
          ¬© <span id="year"></span> Dream Automation
        </div>
      </aside>

      <!-- Main -->
      <div class="main">
        <!-- Topbar -->
        <header class="topbar">
          <div class="topbar-left">
            <span class="topbar-title">Dashboard</span>
            <span class="topbar-badge">Manage your licenses &amp; downloads</span>
          </div>
          <div class="topbar-right">
            <div class="chip" id="nav-username">Welcome</div>
            <a href="index.html" class="btn btn-outline">Back to site</a>
            <button class="btn btn-danger" id="logout-btn">Log out</button>
          </div>
        </header>

        <!-- Content -->
        <main class="content">
          <div class="pill">
            <span class="pill-dot"></span>
            <span>All-in-one automation suite for your business</span>
          </div>
          <h1 class="section-title">
            Welcome, <span id="dash-username">abdulla</span>
          </h1>
          <p class="section-subtitle">
            Manage your license, download the software and access all AI tools
            from a single dashboard.
          </p>

          <section class="grid-2" style="margin-top: 20px">
            <!-- Product card -->
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">Your Product</div>
                  <div style="font-size: 12px; opacity: 0.8; margin-top: 2px">
                    Dream Automation ‚Äì All-in-one automation software for your
                    business.
                  </div>
                </div>
                <span class="pill-small">AI-powered</span>
              </div>

              <div class="tag-row">
                <span class="tag">üöÄ 1-click workflows</span>
                <span class="tag">üíæ Lifetime updates (lifetime plan)</span>
                <span class="tag">üåê Multi-platform</span>
              </div>

              <button class="btn-wide">‚Üì Download Software</button>

              <div class="small-text">
                TODO: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá download link ‡¶¨‡¶∏‡¶æ‡¶ì (Google Drive / ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ server
                ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø)‡•§
              </div>

              <button class="btn-wide secondary" style="margin-top: 14px">
                üí≥ Buy Lifetime Access
              </button>
              <div class="small-text">
                TODO: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá payment / checkout link ‡¶¨‡¶∏‡¶æ‡¶ì (Gumroad, Stripe
                ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø)‡•§
              </div>
            </div>

            <!-- Account overview / Trial -->
            <div class="card">
              <div class="card-header">
                <div>
                  <div class="card-title">Account Overview</div>
                  <div style="font-size: 12px; opacity: 0.8; margin-top: 2px">
                    Basic account information and current plan.
                  </div>
                </div>
                <div class="pill-plan">
                  <span class="pill-plan-dot" id="plan-dot"></span>
                  <span id="plan-status">Free</span>
                </div>
              </div>

              <div style="font-size: 13px; line-height: 1.6">
                <div>
                  <strong>Email:</strong>
                  <span id="dash-email">loading‚Ä¶</span>
                </div>
                <div>
                  <strong>Plan:</strong>
                  <span id="plan-name">Free / Trial (not requested)</span>
                </div>
              </div>

              <div
                class="trial-status"
                id="trial-message"
                style="margin-top: 10px"
              >
                Loading trial status‚Ä¶
              </div>

              <button
                class="btn-wide"
                style="margin-top: 8px"
                id="request-trial-btn"
              >
                Request 2-Day Free Trial
              </button>

              <!-- BIG KEY BOX -->
              <div
                class="trial-key-box"
                id="trial-key-box"
                style="display: none"
              >
                <div class="trial-key">
                  <span class="trial-key-label">Your Key = </span>
                  <span class="trial-key-value" id="trial-key-text"></span>
                </div>
              </div>
            </div>
          </section>

          <!-- Available tools -->
          <section class="tools-section">
            <h2
              style="
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 8px;
                display: flex;
                align-items: center;
                gap: 8px;
              "
            >
              Available AI Tools
              <span
                style="
                  font-size: 11px;
                  font-weight: 500;
                  padding: 2px 8px;
                  border-radius: 999px;
                  background: rgba(148, 163, 184, 0.15);
                "
                >Included with your license</span
              >
            </h2>

            <div class="tools-grid">
              <div class="tool-card">
                <div class="tool-title">
                  ‚úì YouTube Video ‚Üí AI Video (One Click)
                </div>
                <div style="font-size: 12px; opacity: 0.9">
                  ‡¶è‡¶ï ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡ßá YouTube ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ AI ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶§‡ßà‡¶∞‡¶ø‡•§
                </div>
              </div>

              <div class="tool-card">
                <div class="tool-title">
                  ‚úì Text ‚Üí Video (AI Video Generator)
                </div>
                <div style="font-size: 12px; opacity: 0.9">
                  ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‚Üí ‡¶Ö‡¶ü‡ßã ‡¶≠‡¶ø‡¶ú‡ßç‡¶Ø‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤, ‡¶∏‡¶ø‡¶®, ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡•§
                </div>
              </div>

              <div class="tool-card">
                <div class="tool-title">
                  ‚úì Script ‚Üí Long Video (One Click)
                </div>
                <div style="font-size: 12px; opacity: 0.9">
                  ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶¶‡¶ø‡¶® ‚Üí AI ‡¶Ö‡¶ü‡ßã ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° + ‡¶∏‡¶ø‡¶® + ‡¶¶‡ßÄ‡¶∞‡ßç‡¶ò ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶§‡ßà‡¶∞‡¶ø
                  ‡¶ï‡¶∞‡¶¨‡ßá‡•§
                </div>
              </div>

              <div class="tool-card">
                <div class="tool-title">‚úì Video Prompt Generator</div>
                <div style="font-size: 12px; opacity: 0.9">
                  ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶•‡ßá‡¶ï‡ßá scene-by-scene ‡¶™‡ßç‡¶∞‡¶Æ‡ßç‡¶™‡¶ü ‡¶Ö‡¶ü‡ßã ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡•§
                </div>
              </div>

              <div class="tool-card">
                <div class="tool-title">‚úì AI Cinematic Scene Helper</div>
                <div style="font-size: 12px; opacity: 0.9">
                  ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ AI ‡¶∏‡¶ø‡¶®‡ßá‡¶Æ‡¶æ‡¶ü‡¶ø‡¶ï ‡¶∂‡¶ü ‡¶∏‡¶æ‡¶ú‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶Ø‡¶º‡•§
                </div>
              </div>

              <div class="tool-card">
                <div class="tool-title">‚úì Dedicated Support Team</div>
                <div style="font-size: 12px; opacity: 0.9">
                  ‡ß®‡ß™/‡ß≠ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ ‚Äì ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶ì ‡¶Æ‡ßá‡¶∏‡ßá‡¶û‡ßç‡¶ú‡¶æ‡¶∞‡•§
                </div>
              </div>
            </div>
          </section>

          <div class="footer">
            <span>Need help?</span> Contact us any time ‚Äì your success with
            Dream Automation is our top priority.
          </div>
        </main>
      </div>
    </div>

    <!-- Firebase + Auth + Trial logic -->
    <script type="module">
      // ===== ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ span ‡¶è ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶¨‡¶õ‡¶∞ ‡¶¨‡¶∏‡¶æ‡¶á =====
      const yearEl = document.getElementById("year");
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      // ===== ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ Bridge Apps Script URL (JSONP) =====
      const BRIDGE_API_URL =
        "https://script.google.com/macros/s/AKfycbwUMn-tpNUlbaOoYQLA_7RRS_geJ-Vl0z1gLs8goCMB62yyXaTeJr4xKU3SRZGnoIMK/exec";

      // ----- JSONP helper: CORS ‡¶è‡¶°‡¶º‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø -----
      function jsonp(url) {
        return new Promise((resolve, reject) => {
          const cbName = "cb_" + Math.random().toString(36).slice(2);
          window[cbName] = (data) => {
            resolve(data);
            delete window[cbName];
            script.remove();
          };
          const script = document.createElement("script");
          script.src = url + (url.includes("?") ? "&" : "?") + "callback=" + cbName;
          script.onerror = (err) => {
            reject(err);
            delete window[cbName];
            script.remove();
          };
          document.body.appendChild(script);
        });
      }

      // ----- Apps Script trial API ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® -----
      async function callTrialApi(action, email) {
        const url =
          BRIDGE_API_URL +
          "?action=" +
          encodeURIComponent(action) +
          "&email=" +
          encodeURIComponent(email);
        const data = await jsonp(url);
        return data;
      }

      // ===== Firebase imports =====
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
      import {
        getAuth,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

      // ===== Firebase config (‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡ßã‡¶ú‡ßá‡¶ï‡ßç‡¶ü) =====
      const firebaseConfig = {
        apiKey: "AIzaSyA_lZmfn4T31B6jm1dB0UywR7OEgYIPlo0",
        authDomain: "sceneflow-studio.firebaseapp.com",
        projectId: "sceneflow-studio",
        storageBucket: "sceneflow-studio.firebasestorage.app",
        messagingSenderId: "961327164320",
        appId: "1:961327164320:web:7ffb160db2529f4c1412c5",
        measurementId: "G-56962H6FQ4",
      };

      const app = initializeApp(firebaseConfig);
      getAnalytics(app);
      const auth = getAuth(app);

      // ===== DOM ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶®‡ßç‡¶∏‡¶ó‡ßÅ‡¶≤‡ßã =====
      const navUsername = document.getElementById("nav-username");
      const dashUsername = document.getElementById("dash-username");
      const dashEmail = document.getElementById("dash-email");
      const planNameEl = document.getElementById("plan-name");
      const planStatusEl = document.getElementById("plan-status");
      const requestTrialBtn = document.getElementById("request-trial-btn");
      const trialMessage = document.getElementById("trial-message");
      const trialKeyBox = document.getElementById("trial-key-box");
      const trialKeyText = document.getElementById("trial-key-text");
      const logoutBtn = document.getElementById("logout-btn");

      let currentUser = null;

      function setText(el, text) {
        if (el) el.textContent = text;
      }

      function showTrialKey(key) {
        if (!trialKeyBox || !trialKeyText) return;
        if (!key) {
          trialKeyBox.style.display = "none";
          return;
        }
        trialKeyBox.style.display = "block";
        trialKeyText.textContent = key;
      }

      // ===== Expires date ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡¶≠‡¶æ‡¶¨‡ßá (‡¶¶‡¶ø‡¶® ‡¶Æ‡¶æ‡¶∏ ‡¶¨‡¶õ‡¶∞) =====
      function formatExpiryDMY(expiry) {
        if (!expiry) return "";
        const d = new Date(expiry);
        if (isNaN(d.getTime())) return expiry;

        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];

        const day = String(d.getUTCDate()).padStart(2, "0");
        const month = months[d.getUTCMonth()];
        const year = d.getUTCFullYear();
        return `${day} ${month} ${year}`; // eg. 05 Dec 2025
      }

      // Apps Script ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶∏‡¶æ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
      function updateTrialUI(data) {
        if (!data || data.status !== "ok") {
          const msg =
            data && data.message ? data.message : "Could not load trial info.";
          if (trialMessage) trialMessage.textContent = "Error: " + msg;
          if (requestTrialBtn) {
            requestTrialBtn.disabled = true;
            requestTrialBtn.textContent = "Error";
          }
          showTrialKey(null);
          return;
        }

        const state = data.state; // none | active | expired | already_active | created
        const key = data.license_key || "";
        const expiry = data.expiry || "";
        const niceExpiry = formatExpiryDMY(expiry);

        if (state === "none") {
          setText(planNameEl, "Free / Trial (not requested)");
          setText(planStatusEl, "Free");
          if (trialMessage)
            trialMessage.textContent = "You can request a free 2-day trial.";
          showTrialKey(null);
          if (requestTrialBtn) {
            requestTrialBtn.disabled = false;
            requestTrialBtn.textContent = "Request 2-Day Free Trial";
          }
          return;
        }

        if (state === "active" || state === "already_active" || state === "created") {
          setText(planNameEl, "Trial (active)");
          setText(planStatusEl, "Active");
          if (trialMessage)
            trialMessage.textContent =
              "Your 2-day trial is active. Use the key below inside the software." +
              (niceExpiry ? " Expires on: " + niceExpiry : "");
          showTrialKey(key);
          if (requestTrialBtn) {
            requestTrialBtn.disabled = true;
            requestTrialBtn.textContent = "Trial active";
          }
          return;
        }

        if (state === "expired") {
          setText(planNameEl, "Trial (expired)");
          setText(planStatusEl, "Expired");
          if (trialMessage)
            trialMessage.textContent =
              "Your 2-day trial has expired." +
              (niceExpiry ? " Expired on: " + niceExpiry : "");
          showTrialKey(key);
          if (requestTrialBtn) {
            requestTrialBtn.disabled = true;
            requestTrialBtn.textContent = "Trial expired";
          }
          return;
        }

        if (trialMessage) trialMessage.textContent = "Unknown state: " + state;
        showTrialKey(key);
        if (requestTrialBtn) requestTrialBtn.disabled = true;
      }

      // ===== Auth state change =====
      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          // ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá main site ‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡¶ì
          window.location.href = "index.html#auth";
          return;
        }
        currentUser = user;
        const email = (user.email || "").toLowerCase();

        setText(navUsername, "Welcome, " + (user.displayName || email));
        setText(dashUsername, user.displayName || email);
        setText(dashEmail, email);

        try {
          const data = await callTrialApi("trial_status", email);
          updateTrialUI(data);
        } catch (err) {
          console.error("trial_status error:", err);
          if (trialMessage)
            trialMessage.textContent = "Error loading trial status.";
        }
      });

      // ===== Trial request ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ =====
      if (requestTrialBtn) {
        requestTrialBtn.addEventListener("click", async () => {
          if (!currentUser) return;
          const email = (currentUser.email || "").toLowerCase();

          requestTrialBtn.disabled = true;
          requestTrialBtn.textContent = "Requesting...";

          try {
            const data = await callTrialApi("trial_create", email);
            if (data.status !== "ok" && data.message) {
              alert("Error: " + data.message);
            }
            updateTrialUI(data);
          } catch (err) {
            console.error("trial_create error:", err);
            alert("Network error: " + err);
            requestTrialBtn.disabled = false;
            requestTrialBtn.textContent = "Request 2-Day Free Trial";
          }
        });
      }

      // ===== Logout ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ =====
      if (logoutBtn) {
        logoutBtn.addEventListener("click", async () => {
          try {
            await signOut(auth);
          } catch (e) {
            console.error(e);
          }
          window.location.href = "index.html";
        });
      }
    </script>
  </body>
</html>
