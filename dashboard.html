<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dream Automation ‚Äì Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Poppins", sans-serif;
      background: radial-gradient(circle at top left, #5827d8, #020014);
      color: #fff;
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
    }
    a { color: inherit; text-decoration: none; }

    .btn {
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      background: transparent;
      color: #fff;
    }
    .btn-outline { border-color: rgba(255,255,255,0.35); }
    .btn-primary {
      background: linear-gradient(135deg,#32e6ff,#4eff9a);
      color: #020014;
      font-weight: 600;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: default;
    }

    /* Sidebar */
    .sidebar {
      width: 230px;
      background: #050316;
      border-right: 1px solid rgba(255,255,255,0.08);
      padding: 16px 14px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 1.15rem;
    }
    .logo-badge {
      width: 24px;
      height: 24px;
      border-radius: 8px;
      background: linear-gradient(135deg,#ff4b81,#ff9a62);
    }
    .side-nav {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
      font-size: 0.9rem;
    }
    .side-link {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      cursor: pointer;
      color: rgba(255,255,255,0.8);
      transition: background 0.15s, color 0.15s;
    }
    .side-link span.icon {
      font-size: 1rem;
      width: 20px;
      text-align: center;
    }
    .side-link.active,
    .side-link:hover {
      background: rgba(255,255,255,0.08);
      color: #fff;
    }

    .side-footer {
      margin-top: auto;
      border-top: 1px solid rgba(255,255,255,0.08);
      padding-top: 12px;
      font-size: 0.8rem;
      color: rgba(255,255,255,0.6);
    }

    /* Main area */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
    .topbar {
      height: 56px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 24px;
      background: rgba(2,0,20,0.9);
      backdrop-filter: blur(10px);
    }
    .top-title {
      font-size: 0.95rem;
      color: rgba(255,255,255,0.76);
    }
    .top-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.85rem;
    }
    .user-pill {
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.25);
    }

    .content {
      padding: 24px;
      overflow-x: hidden;
      overflow-y: auto;
    }
    .hero {
      background: radial-gradient(circle at top,#271f6d,#050218);
      border-radius: 24px;
      padding: 26px 26px 24px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: 0 22px 60px rgba(0,0,0,0.9);
      margin-bottom: 24px;
    }
    .hero h1 {
      font-size: 2rem;
      margin-bottom: 6px;
    }
    .hero p {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.8);
      max-width: 520px;
    }
    .hero-tag {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.1);
      font-size: 0.8rem;
      margin-bottom: 10px;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: minmax(0,1.4fr) minmax(0,1fr);
      gap: 18px;
      margin-top: 18px;
    }
    .card {
      background: rgba(0,0,0,0.55);
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.08);
      padding: 16px 16px 18px;
      font-size: 0.9rem;
    }
    .card h3 {
      font-size: 1.05rem;
      margin-bottom: 6px;
    }
    .card p {
      font-size: 0.88rem;
      color: rgba(255,255,255,0.82);
      margin-bottom: 10px;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }
    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.15);
      font-size: 0.78rem;
    }
    .download-links {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .download-links small {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.75);
    }

    .tools-section {
      margin-top: 18px;
    }
    .tools-title {
      font-size: 1rem;
      margin-bottom: 10px;
    }
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 14px;
    }
    .tool-card {
      background: rgba(0,0,0,0.5);
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid rgba(255,255,255,0.06);
      font-size: 0.85rem;
    }
    .tool-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .small-text {
      font-size: 0.78rem;
      color: rgba(255,255,255,0.78);
      margin-top: 4px;
    }

    .trial-key-box {
      margin-top: 12px;
      padding: 10px 14px;
      border-radius: 14px;
      background: rgba(0,0,0,0.75);
      border: 1px solid rgba(255,255,255,0.2);
      display: none;
    }
    .trial-key-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      opacity: 0.8;
    }
    .trial-key-value {
      font-size: 1rem;
      margin-top: 4px;
      font-weight: 600;
      word-break: break-all;
    }

    @media (max-width: 900px) {
      body { flex-direction: column; }
      .sidebar {
        width: 100%;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
      .side-nav { display: none; }
      .main { flex: 1; }
    }
    @media (max-width: 800px) {
      .cards-grid,
      .tools-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div>
      <div class="logo">
        <div class="logo-badge"></div>
        Dream Automation
      </div>

      <nav class="side-nav">
        <div class="side-link active">
          <span class="icon">üè†</span>
          <span>Dashboard</span>
        </div>
        <div class="side-link">
          <span class="icon">üì¶</span>
          <span>My Products</span>
        </div>
        <div class="side-link">
          <span class="icon">üßæ</span>
          <span>Orders</span>
        </div>
        <div class="side-link">
          <span class="icon">‚öôÔ∏è</span>
          <span>Account Settings</span>
        </div>
        <div class="side-link">
          <span class="icon">üí¨</span>
          <span>Support Center</span>
        </div>
      </nav>
    </div>

    <div class="side-footer">
      <div>¬© <span id="year"></span> Dream Automation</div>
    </div>
  </aside>

  <!-- Main area -->
  <div class="main">
    <!-- Topbar -->
    <header class="topbar">
      <div class="top-title">Dashboard</div>
      <div class="top-right">
        <div class="user-pill" id="nav-username">Welcome, user</div>
        <a href="index.html" class="btn btn-outline">Back to site</a>
        <button class="btn btn-primary" id="logout-btn">Log out</button>
      </div>
    </header>

    <!-- Content -->
    <main class="content">
      <section class="hero">
        <div class="hero-tag">üöÄ Explore Your AI Suite</div>
        <h1>Welcome, <span id="dash-username">User</span></h1>
        <p>Manage your license, download Dream Automation and access all AI tools from a single dashboard.</p>

        <div class="cards-grid">
          <!-- Product card -->
          <div class="card">
            <h3>Your Product</h3>
            <p>Dream Automation ‚Äì All-in-one automation software for your business.</p>
            <div class="pill-row">
              <span class="pill">AI-powered</span>
              <span class="pill">1-click workflows</span>
              <span class="pill">Lifetime updates (lifetime plan)</span>
            </div>
            <div class="download-links">
              <a
                href="#"
                class="btn btn-primary"
                style="justify-content:center;"
              >
                ‚¨á Download Software
              </a>
              <small>TODO: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶∏‡¶≤ download link ‡¶¨‡¶∏‡¶æ‡¶ì (Google Drive / ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ server ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø)‡•§</small>

              <a
                href="#"
                class="btn btn-outline"
                style="justify-content:center;margin-top:4px;"
              >
                üí≥ Buy Lifetime Access
              </a>
              <small>TODO: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá payment / checkout link ‡¶¨‡¶∏‡¶æ‡¶ì (Gumroad, Stripe ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø)‡•§</small>
            </div>
          </div>

          <!-- Account overview + trial system -->
          <div class="card">
            <h3>Account Overview</h3>
            <p>Basic account information and current plan.</p>
            <ul style="font-size:0.9rem; padding-left:18px;">
              <li>Email: <span id="dash-email">user@example.com</span></li>
              <li>
                Plan:
                <span id="plan-name"><strong>Free / Trial (not requested)</strong></span>
              </li>
              <li>
                Status:
                <span id="plan-status"><strong>Free</strong></span>
              </li>
            </ul>

            <hr style="margin:10px 0; border-color:rgba(255,255,255,0.15);" />

            <div>
              <button class="btn btn-outline" id="request-trial-btn">
                Request 3-Day Free Trial
              </button>
              <p class="small-text" id="trial-message">
                You can request a 3-day free trial. We‚Äôll generate a trial key for you automatically.
              </p>
            </div>

            <!-- Trial key display -->
            <div class="trial-key-box" id="trial-key-box">
              <div class="trial-key-label">Your free trial key</div>
              <div class="trial-key-value" id="trial-key-text">
                <!-- key will appear here -->
              </div>
              <p class="small-text">
                Copy this key and use it inside the software. This key is only for your 3-day trial.
              </p>
            </div>
          </div>
        </div>

        <!-- Tools cards -->
        <div class="tools-section">
          <div class="tools-title">Available AI Tools</div>
          <div class="tools-grid">
            <div class="tool-card">
              <div class="tool-name">‚úî YouTube Video ‚Üí AI Video (One Click)</div>
              <div>‡¶è‡¶ï ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï‡ßá YouTube ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ AI ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶§‡ßà‡¶∞‡¶ø‡•§</div>
            </div>
            <div class="tool-card">
              <div class="tool-name">‚úî Text ‚Üí Video (AI Video Generator)</div>
              <div>‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‚Üí ‡¶Ö‡¶ü‡ßã ‡¶≠‡¶ø‡¶ú‡ßç‡¶Ø‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤, ‡¶∏‡¶ø‡¶®, ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡•§</div>
            </div>
            <div class="tool-card">
              <div class="tool-name">‚úî Script ‚Üí Long Video (One Click)</div>
              <div>‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶¶‡¶ø‡¶® ‚Üí AI ‡¶Ö‡¶ü‡ßã ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° + ‡¶∏‡¶ø‡¶® + ‡¶¶‡ßÄ‡¶∞‡ßç‡¶ò ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡•§</div>
            </div>
            <div class="tool-card">
              <div class="tool-name">‚úî Video Prompt Generator</div>
              <div>‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶•‡ßá‡¶ï‡ßá scene-by-scene ‡¶™‡ßç‡¶∞‡¶Æ‡ßç‡¶™‡¶ü ‡¶Ö‡¶ü‡ßã ‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü‡•§</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Firebase + Auth + Firestore -->
  <script type="module">
  // ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ span ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶õ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶ø
  const yearEl = document.getElementById("year");
  if (yearEl) yearEl.textContent = new Date().getFullYear();

  // ==== ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶®‡¶§‡ßÅ‡¶® Apps Script URL ====
  const BRIDGE_API_URL = "https://script.google.com/macros/s/AKfycbwUMn-tpNUlbaOoYQLA_7RRS_geJ-Vl0z1gLs8goCMB62yyXaTeJr4xKU3SRZGnoIMK/exec";

  async function callTrialApi(action, email) {
    const res = await fetch(BRIDGE_API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action, email }),
    });
    return await res.json();
  }

  // ===== Firebase imports =====
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
  import {
    getAuth,
    onAuthStateChanged,
    signOut,
  } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

  // ===== Firebase config (‡¶§‡ßã‡¶Æ‡¶æ‡¶∞‡¶ü‡¶æ‡¶á) =====
  const firebaseConfig = {
    apiKey: "AIzaSyA_lZmfn4T31B6jm1dB0UywR7OEgYIPlo0",
    authDomain: "sceneflow-studio.firebaseapp.com",
    projectId: "sceneflow-studio",
    storageBucket: "sceneflow-studio.firebasestorage.app",
    messagingSenderId: "961327164320",
    appId: "1:961327164320:web:7ffb160db2529f4c1412c5",
    measurementId: "G-56962H6FQ4",
  };

  const app = initializeApp(firebaseConfig);
  getAnalytics(app);
  const auth = getAuth(app);

  // ===== DOM ‡¶è‡¶≤‡¶ø‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡¶ó‡ßÅ‡¶≤‡ßã =====
  const navUsername     = document.getElementById("nav-username");
  const dashUsername    = document.getElementById("dash-username");
  const dashEmail       = document.getElementById("dash-email");
  const planNameEl      = document.getElementById("plan-name");
  const planStatusEl    = document.getElementById("plan-status");
  const requestTrialBtn = document.getElementById("request-trial-btn");
  const trialMessage    = document.getElementById("trial-message");
  const trialKeyBox     = document.getElementById("trial-key-box");
  const trialKeyText    = document.getElementById("trial-key-text");
  const logoutBtn       = document.getElementById("logout-btn");

  let currentUser = null;

  function setText(el, text) {
    if (el) el.textContent = text;
  }

  function showTrialKey(key) {
    if (!trialKeyBox || !trialKeyText) return;
    if (!key) {
      trialKeyBox.style.display = "none";
      return;
    }
    trialKeyBox.style.display = "block";
    trialKeyText.textContent = key;
  }

  // Apps Script ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶∏‡¶æ ‡¶∞‡ßá‡¶∏‡¶™‡¶®‡ßç‡¶∏ ‡¶¶‡¶ø‡ßü‡ßá UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
  function updateTrialUI(data) {
    if (!data || data.status !== "ok") {
      const msg = data && data.message ? data.message : "Could not load trial info.";
      if (trialMessage) trialMessage.textContent = "Error: " + msg;
      if (requestTrialBtn) {
        requestTrialBtn.disabled = true;
        requestTrialBtn.textContent = "Error";
      }
      showTrialKey(null);
      return;
    }

    const state = data.state; // none | active | expired | already_active | created

    // ‡¶è‡¶ñ‡¶® ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ key (‡¶•‡¶æ‡¶ï‡¶≤‡ßá)
    const key = data.license_key || "";
    const expiry = data.expiry || "";

    if (state === "none") {
      setText(planNameEl, "Free / Trial (not requested)");
      setText(planStatusEl, "Free");
      if (trialMessage)
        trialMessage.textContent = "You can request a 3-day free trial.";
      showTrialKey(null);
      if (requestTrialBtn) {
        requestTrialBtn.disabled = false;
        requestTrialBtn.textContent = "Request 3-Day Free Trial";
      }
      return;
    }

    if (state === "active" || state === "already_active" || state === "created") {
      setText(planNameEl, "Trial (active)");
      setText(planStatusEl, "Active");
      if (trialMessage)
        trialMessage.textContent =
          "Your 3-day trial is active. Use the key below inside the software." +
          (expiry ? " Expires at: " + expiry : "");
      showTrialKey(key);
      if (requestTrialBtn) {
        requestTrialBtn.disabled = true;
        requestTrialBtn.textContent = "Trial active";
      }
      return;
    }

    if (state === "expired") {
      setText(planNameEl, "Trial (expired)");
      setText(planStatusEl, "Expired");
      if (trialMessage)
        trialMessage.textContent =
          "Your 3-day trial has expired." +
          (expiry ? " Expired at: " + expiry : "");
      showTrialKey(key);
      if (requestTrialBtn) {
        requestTrialBtn.disabled = true;
        requestTrialBtn.textContent = "Trial expired";
      }
      return;
    }

    // ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶∏‡ßç‡¶ü‡ßá‡¶ü
    if (trialMessage)
      trialMessage.textContent = "Unknown state: " + state;
    showTrialKey(key);
    if (requestTrialBtn) requestTrialBtn.disabled = true;
  }

  // ===== Auth state =====
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.href = "index.html#auth";
      return;
    }
    currentUser = user;

    const email = (user.email || "").toLowerCase();

    setText(navUsername, "Welcome, " + (user.displayName || email));
    setText(dashUsername, user.displayName || email);
    setText(dashEmail, email);

    try {
      const data = await callTrialApi("trial_status", email);
      updateTrialUI(data);
    } catch (err) {
      console.error("trial_status error:", err);
      if (trialMessage)
        trialMessage.textContent = "Error loading trial status.";
    }
  });

  // ===== Trial request ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ =====
  if (requestTrialBtn) {
    requestTrialBtn.addEventListener("click", async () => {
      if (!currentUser) return;
      const email = (currentUser.email || "").toLowerCase();

      requestTrialBtn.disabled = true;
      requestTrialBtn.textContent = "Requesting...";

      try {
        const data = await callTrialApi("trial_create", email);
        if (data.status !== "ok" && data.message) {
          alert("Error: " + data.message);
        }
        updateTrialUI(data);
      } catch (err) {
        console.error("trial_create error:", err);
        alert("Network error: " + err);
        requestTrialBtn.disabled = false;
        requestTrialBtn.textContent = "Request 3-Day Free Trial";
      }
    });
  }

  // ===== Logout ‡¶¨‡ßã‡¶§‡¶æ‡¶Æ =====
  if (logoutBtn) {
    logoutBtn.addEventListener("click", async () => {
      try {
        await signOut(auth);
      } catch (e) {
        console.error(e);
      }
      window.location.href = "index.html";
    });
  }
</script>


</body>
</html>
